<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/i/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>EasyTomato</title>
  <meta name="description" content="">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

	<link rel="stylesheet" href="css/reset.css" />
	<link rel="stylesheet" href="css/text.css" />
	<link rel="stylesheet" href="css/960.css" />
	<link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/table-style.css">
  <link rel="stylesheet" href="js/libs/jquery-ui-1.9.1.custom/css/blitzer/jquery-ui-1.9.1.custom.min.css" type="text/css" media="screen" />
   <script type="text/javascript" src="js/libs/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="js/libs/jquery-ui-1.9.1.custom/js/jquery-ui-1.9.1.custom.min.js"></script>



     <style>
  svg {
  font: 10px sans-serif;
}

path.area {
  fill: black;
}

path.area {
  stroke: none;
}

path.plot {
 /*  stroke: steelblue; This is now set by the elements */
  stroke-width: 2px;
  fill-rule: evenodd;
  fill: none;
}

circle.highlight {
 stroke: steelblue;
 fill: black;
}

.axis path, .axis line, .grid path, .grid line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

  
  </style>


  <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->

  <!-- All JavaScript at the bottom, except this Modernizr build.
       Modernizr enables HTML5 elements & feature detects for optimal performance.
       Create your own custom Modernizr build: www.modernizr.com/download/ -->
    <script>
    $(function() {
        $( "#tabs" ).tabs();
        $( "#tabs" ).bind( "tabsselect", function(event, ui) {
          rxIsActive = ui.index === 0;
          txIsActive = ui.index === 1;
          if (rxIsActive) {
            d3.select("#rxGraph").datum(totalsData).call(rxGraph);
          } else {
            d3.select("#rxGraph").datum([]).call(rxGraph);
          }
          if (txIsActive) {
            d3.select("#txGraph").datum(totalsData).call(txGraph);
          } else {
            d3.select("#txGraph").datum([]).call(txGraph);
          }
        }); 
    });
    </script>
</head>
<body>
  <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you support IE 6.
       chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
  <header class="container_16" id="header">
  
		  <div class="grid_1">
		    <a href="javascript:void(0);" class="home_link">Home</a>
		  </div>
		  <!-- end .grid_2 -->
		  <div class="advanced_box">
		    <p> <a href="status-overview.asp">[+] AdvancedTomato</a> </p>
		    <div class="tomato_time"></div>
		  </div>
	
		    <h1> EasyTomato</h1>
		  <div class="clear"></div>	  
  </header>
  <!-- end #header -->
  
  <div role="main" id="computers" class="main container_16">	  
	  
	  <div id="topnav">
		<ul>
			<!--
<li>
				<a href="javascript:void(0);">Overview</a>
			</li>
-->
			<li>
				<a href="groups.html">Groups</a>
			</li>
			<li class="active_tab">
				<a href="computers.html">Computers</a>
			</li>
			<li>
				<a href="settings.html">Settings</a>
			</li>
		</ul>		
		    
		<div class="clear"></div>
	  </div>
	  <!-- end #topnav -->
 

<div id="net_usage_box" class="grid_16">
      <div class="usage_header">
      <div class="time_toggle_box">
        <span>Time Range:</span>
        
        <a href="javascript:void(0);" class="time_toggle" data-hours="1">1</a>
        <a href="javascript:void(0);" class="time_toggle" data-hours="2">2</a>
        <a href="javascript:void(0);" class="time_toggle" data-hours="6">6</a>
        <a href="javascript:void(0);" class="time_toggle" data-hours="12">12</a>
        <a href="javascript:void(0);" class="time_toggle time_toggle_active" data-hours="24">24</a>
      
      </div>
      
      <p class="blue_bgme">Internet Usage</p>
    </div>  



  <!-- TABS -->
	 <div id="tabs">
    <ul>
        <li><a href="#tabs-1">Download</a></li>
        <li><a href="#tabs-2">Upload</a></li>
        <li><a href="#tabs-3">Download/Upload</a></li>
      </ul>
      <div id="tabs-1">
          <div id="content" class="container">
              <div class="row">
                <div class="span6">
                  <h2>Downloaded</h2>
                    <div id="rxGraph" class="row"></div>
    
        </div>
      </div>
    </div>
    </div>
    <div id="tabs-2">
        <div class="row">
          <div class="span6">
        <h2>Uploaded</h2>
        <div id="txGraph" class="row"></div>
      </div>
    </div>
   </div>
    <div id="tabs-3">
        <p>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</p>
    </div>
</div> 

	
   
    
    <div id="table" class="pretty_table"><h4>Currently Connected Devices</h4></div>
  </div>
	  <!-- end #content -->
	  
  </div>
  <!-- end #main -->

  <footer class="container_16" id="footer">
		<p>Copyright 2012 EasyTomato.org - Version 0.7.7 Beta</p>
  </footer>


  <!-- JavaScript at the bottom for fast page loading -->
  <script type="text/javascript" src="js/libs/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="js/libs/jquery-ui-1.9.1.custom/js/jquery-ui-1.9.1.custom.min.js"></script>
  <script type="text/javascript" src="js/easytomato.js"></script>
  <script type="text/javascript" src="js/libs/d3.v2.js"></script>
  <script type="text/javascript" src="js/libs/underscore-min.js"></script>
  <script type="text/javascript" src="js/data.js"></script>
  <script type="text/javascript" src="js/table.js"></script>
  <script type="text/javascript" src="js/graph.js"></script>
  <script type="text/javascript" src="js/computers.js"></script>

  <!-- end scripts -->

 <script type="text/javascript">
   // Need to transform data from:
   // { "192.168.1.1": { rx : [0,0,01,2,4,5], ...}
   // }
   //  into:
   // {
   //   name : "192.168.1.1 RX",
   //   color : "blue",
   //   rxData: [ { x: ADate, y: 123
   //    }
   //   txData: [ { x: ADate, y: 123
   //    }
   //    ...
   //   ]
   
   var colors = d3.scale.category10();
   
   var data = _.flatten(d3.entries(speed_history).map(function(series, i) {
   
     if (series.value.rx) { 
       var numRxPoints = series.value.rx.length;
       var now = new Date()
       var rxScale = d3.time.scale().domain([new Date(now.getTime() - 24*60*60*1000), now]).range([0, numRxPoints]);
       var rxTransformed =  series.value.rx.map(function(spotValue, i) {
         return { x: rxScale.invert(i),
            y: spotValue
          }
       });

       var txTransformed =  series.value.tx.map(function(spotValue, i) {
         return { x: rxScale.invert(i),
            y: spotValue
          }
       });
       
       return [{
         ip: series.key,
         name: series.key,
         color: colors(i),
         areaColor: colors(i),
         rxData: rxTransformed,
         txData: txTransformed,
         rx_avg: series.value.rx_avg,
         rx_max: series.value.rx_max,
         rx_total: series.value.rx_total,
         tx_avg: series.value.tx_avg,
         tx_max: series.value.tx_max,
         tx_total: series.value.tx_total,
       }];
     }
     else {
       return [];
     }
   }));
   
   function isSubnet(d) {
    reg = /\.0$/;
    return reg.test(d.name);
   }

   // Default function, puts out raw.
  function rawFormat(d) { 
    return d; 
  }
  function formatSpeed(speed) {
    var suffix = ["bps", "kbps", "mbps", "tbps"];

    return reduceToPower(speed, suffix);
  }

  function formatSize(size) {
    var suffix = ["B", "KB", "MB", "TB", "PT"];

    return reduceToPower(size, suffix);
  }

  function reduceToPower(number, suffixes) {
    var power = 0;
    while (number >= 1000) {
      number = number / 1000;
      power++;
    }

    return Math.round(number) + suffixes[power];
  }

   // Anything ending in a .0 is a subnet total.
   totalsData = _.filter(data, isSubnet)
   perComputerData = _.filter(data, function(d) { return !isSubnet(d); })
     
   var rxGraph = new usageGraph("rx")
     .plotDataFunction(function(d) { return d.rxData; })
     .height(300)
     .width(900)
     .showArea(true)
     .yLabelFunction(formatSpeed)
     //.plotInterestingPointFunction(function(d) { return d.rxData; });
     .plotInterestingPointFunction(function(d) { return []; });
   
   var rxIsActive = true,
    txIsActive = false;
   if (rxIsActive) {
     d3.select("#rxGraph").datum(totalsData).call(rxGraph);
   } else {
     d3.select("#rxGraph").datum([]).call(rxGraph);
   }
   

   var txGraph = new usageGraph("tx")
     .plotDataFunction(function(d) { return d.txData; })
     .height(300)
     .width(900)
     .showArea(true)
     .yLabelFunction(formatSpeed)
     //.plotInterestingPointFunction(function(d) { return d.rxData; });
     .plotInterestingPointFunction(function(d) { return []; });

    if (txIsActive) {
         d3.select("#txGraph").datum(totalsData).call(txGraph);
    } else {
      d3.select("#txGraph").datum([]).call(txGraph);
    }

   var highlightOverFunction = function(d) {
    setTimeout(function() {
      var dataToPlot = data.filter(function(dataSet) { return d.name == dataSet.name; });
      dataToPlot = totalsData.concat(dataToPlot);
      d3.select("#rxGraph").datum(dataToPlot).call(rxGraph.quickRedraw);
      d3.select("#txGraph").datum(dataToPlot).call(txGraph.quickRedraw);
    }, 0);  
   }

   var highlightOutFunction = function(d) {
    setTimeout(function() {
      // reset to just plot the single one
      d3.select("#rxGraph").datum(totalsData).call(rxGraph);
      d3.select("#txGraph").datum(totalsData).call(txGraph);
    }, 0);
    
   }

   var dataTable = new usageTable("usage")
    // .dataKeyFunc(function(d) { return d.ip; })
     .rowOnMouseOver(highlightOverFunction);
  //   .rowOnMouseOut(highlightOutFunction);
  
  perComputerData = _.sortBy(perComputerData, function(d) { return -1 * + d.rx_total; }) 

  d3.select("#table").datum(perComputerData).call(dataTable);

 </script>


</body>
</html>
