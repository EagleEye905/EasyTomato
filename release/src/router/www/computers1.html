<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/i/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>EasyTomato</title>
  <meta name="description" content="">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

	<link rel="stylesheet" href="css/reset.css" />
	<link rel="stylesheet" href="css/text.css" />
	<link rel="stylesheet" href="css/960.css" />
	<link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/table-style.css">



     <style>
  svg {
  font: 10px sans-serif;
}

path.area {
  fill: black;
}

path.area {
  stroke: none;
  fill: aliceblue;

}

path.plot {
 /*  stroke: steelblue; This is now set by the elements */
  stroke-width: 2px;
  fill-rule: evenodd;
  fill: none;
}

circle.highlight {
 stroke: steelblue;
 fill: black;
}

.axis path, .axis line, .grid path, .grid line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

  
  </style>


  <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->

  <!-- All JavaScript at the bottom, except this Modernizr build.
       Modernizr enables HTML5 elements & feature detects for optimal performance.
       Create your own custom Modernizr build: www.modernizr.com/download/ -->
  <script src="js/libs/modernizr-2.5.3.min.js"></script>
</head>
<body>
  <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you support IE 6.
       chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
  <header class="container_16" id="header">
  
		  <div class="grid_1">
		    <a href="javascript:void(0);" class="home_link">Home</a>
		  </div>
		  <!-- end .grid_2 -->
		  <div class="advanced_box">
		    <p> <a href="status-overview.asp">[+] AdvancedTomato</a> </p>
		    <div class="tomato_time"></div>
		  </div>
	
		    <h1> EasyTomato!!!!!!!!!!!!!!!!!!!!!!! </h1>
		  <div class="clear"></div>	  
  </header>
  <!-- end #header -->
  
  <div role="main" id="computers" class="main container_16">	  
	  
	  <div id="topnav">
		<ul>
			<!--
<li>
				<a href="javascript:void(0);">Overview</a>
			</li>
-->
			<li>
				<a href="groups.html">Groups</a>
			</li>
			<li class="active_tab">
				<a href="computers.html">Computers</a>
			</li>
			<li>
				<a href="settings.html">Settings</a>
			</li>
		</ul>		
		    
		<div class="clear"></div>
	  </div>
	  <!-- end #topnav -->
	  

	<div id="content" class="container">
     <div class="row">
      <div class="span6">
        <h2>Downloaded</h2>
        <div id="rxGraph" class="row"></div>
      </div>
    </div>
    <div class="row">
      <div class="span6">
        <h2>Uploaded</h2>
        <div id="txGraph" class="row"></div>
      </div>
    </div>
    
    <div id="table" class="pretty_table"><h4>Currently Connected Devices</h4></div>
  </div>
	  <!-- end #content -->
	  
  </div>
  <!-- end #main -->

  <footer class="container_16" id="footer">
		<p>Copyright 2012 EasyTomato.org - Version 0.7.7 Beta</p>
  </footer>


  <!-- JavaScript at the bottom for fast page loading -->
  <script type="text/javascript" src="js/libs/jquery-1.7.1.min.js"></script>
  <script type="text/javascript" src="js/libs/jquery-ui-1.8.20/js/jquery-ui-1.8.20.custom.min.js"></script>
  <script type="text/javascript" src="js/easytomato.js"></script>
  <script type="text/javascript" src="js/libs/d3.v2.js"></script>
  <script type="text/javascript" src="js/libs/underscore-min.js"></script>
  <script type="text/javascript" src="js/data.js"></script>
  <script type="text/javascript" src="js/table.js"></script>
  <script type="text/javascript" src="js/graph.js"></script>
  <!-- end scripts -->

 <script type="text/javascript">
   // Need to transform data from:
   // { "192.168.1.1": { rx : [0,0,01,2,4,5], ...}
   // }
   //  into:
   // {
   //   name : "192.168.1.1 RX",
   //   color : "blue",
   //   rxData: [ { x: ADate, y: 123
   //    }
   //   txData: [ { x: ADate, y: 123
   //    }
   //    ...
   //   ]
   
   var colors = d3.scale.category10();
   
   var data = _.flatten(d3.entries(speed_history).map(function(series, i) {
   
     if (series.value.rx) { 
       var numRxPoints = series.value.rx.length;
       var now = new Date()
       var rxScale = d3.time.scale().domain([new Date(now.getTime() - 24*60*60*1000), now]).range([0, numRxPoints]);
       var rxTransformed =  series.value.rx.map(function(spotValue, i) {
         return { x: rxScale.invert(i),
            y: spotValue
          }
       });

       var txTransformed =  series.value.tx.map(function(spotValue, i) {
         return { x: rxScale.invert(i),
            y: spotValue
          }
       });
       
       return [{
         name: series.key,
         color: colors(i),
         rxData: rxTransformed,
         txData: txTransformed,
         rx_avg: series.value.rx_avg,
         rx_max: series.value.rx_max,
         rx_total: series.value.rx_total,
         tx_avg: series.value.tx_avg,
         tx_max: series.value.tx_max,
         tx_total: series.value.tx_total,
       }];
     }
     else {
       return [];
     }
   }));
   
   // This relies on having everything the same length, for now
   var totalsData = _.reduce(
     data, 
     function(total, current) {
       _.each(current.rxData, function(d, i) {
         if (!total.rxData[i]) {
           total.rxData[i] = {
             x: d.x,
             y: d.y
           }
         } else {
           total.rxData[i].y = total.rxData[i].y + d.y;
         }
       });
       _.each(current.txData, function(d, i) {
         if (!total.txData[i]) {
           total.txData[i] = {
             x: d.x,
             y: d.y
           }
         } else {
           total.txData[i].y = total.txData[i].y + d.y;
         }
       })
       
       return total;       
     }, 
     { name : "Totals", color : "blue", rxData: [], txData: []});
     
   var rxGraph = new usageGraph("rx")
     .plotDataFunction(function(d) { return d.rxData; })
     .height(175)
     .width(900)
     //.plotInterestingPointFunction(function(d) { return d.rxData; });
     .plotInterestingPointFunction(function(d) { return []; });
   
   d3.select("#rxGraph").datum([totalsData]).call(rxGraph);

   var txGraph = new usageGraph("tx")
     .plotDataFunction(function(d) { return d.txData; })
     .height(175)
     .width(900)
     //.plotInterestingPointFunction(function(d) { return d.rxData; });
     .plotInterestingPointFunction(function(d) { return []; });

   d3.select("#txGraph").datum([totalsData]).call(txGraph);

   var highlightOverFunction = function(d) {
    var dataToPlot = data.filter(function(dataSet) { return d.name == dataSet.name; });
    dataToPlot.unshift(totalsData);
    d3.select("#rxGraph").datum(dataToPlot).call(rxGraph);
    d3.select("#txGraph").datum(dataToPlot).call(txGraph);
   }

   var highlightOutFunction = function(d) {
    // reset to just plot the single one
    d3.select("#rxGraph").datum([totalsData]).call(rxGraph);
    d3.select("#txGraph").datum([totalsData]).call(txGraph);
   }

   var dataTable = new usageTable("usage")
     .rowOnMouseOver(highlightOverFunction)
     .rowOnMouseOut(highlightOutFunction);
   
   d3.select("#table").datum(data).call(dataTable);

 </script>


</body>
</html>
